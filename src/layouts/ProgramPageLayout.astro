---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

import BaseLayout from "./BaseLayout.astro";
const { frontmatter } = Astro.props;
import { documentToHtmlString } from "@contentful/rich-text-html-renderer";

/* console.log(typeof frontmatter.coverImageSrc); */

const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/images/programs/*.{jpeg,jpg,png,gif}"
);

/* console.log(images); */

if (!images[frontmatter.coverImageSrc])
  throw new Error(
    `"${frontmatter.coverImageSrc}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`
  );
---

<BaseLayout pageTitle={frontmatter.name} showPageTitle={false}>
  <article class="[ program ] [ wrapper flow ]">
    <div class="[ program__hero ]">
      <div class="[ program__hero__text ] [ flow ]">
        <h1 class="[ program__name ]">{frontmatter.name}</h1>
        <div class="[ program__tags ]">
          <span class="[ program__tag program__tag--year ]">
            {
              new Date(frontmatter.year).toLocaleDateString("en-US", {
                year: "numeric",
              })
            }
          </span>
          <span class="[ program__tag program__tag--active ]">Active</span>
          <span class="[ program__tag program__tag--current ]"
            >Currently Funded</span
          >
        </div>
        <p class="[ program__description ]">
          <em>{frontmatter.description}</em>
        </p>
      </div>
      <div>
        <Image
          src={images[frontmatter.coverImageSrc]()}
          alt={frontmatter.coverImageAlt}
          class="program__hero__image"
        />
      </div>
    </div>
    <div
      class="[
          program__content
          ]
          [
          flow
          ]"
      set:html={documentToHtmlString(frontmatter.content)}
    />

    <!-- <slot /> -->
  </article>
</BaseLayout>
